<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Friend Finder</title>

 
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Coiny|Comfortaa" rel="stylesheet">
  <style>

     /* The Modal (background) */
.modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1; /* Sit on top */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgb(0,0,0); /* Fallback color */
    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content/Box */
.modal-content {
    background-color: #fefefe;
    margin: 15% auto; /* 15% from the top and centered */
    padding: 20px;
    border: 1px solid #888;
    width: 80%; /* Could be more or less, depending on screen size */
}

/* The Close Button */
.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
} 
.imagediv, .image {
  height: auto;
  width: 250px;
}
body {
  /* background-image:url('https://png.pngtree.com/thumb_back/fh260/back_pic/04/00/58/5557fdfc4e9e1ed.jpg'); */
  background-image: linear-gradient(to right, rgb(76, 76, 161) , rgb(252, 156, 156));
  /* background-color: grey; */
  font-family: 'Comfortaa', cursive;
  
}
.text-center {
    /* font-family: 'Coiny', cursive !important;
    color: white; */
    margin-top: 20px;
    font-weight: bold;
}
.submit {
  margin-bottom: 30px;
  margin-top: 30px;
}
h3 {
  margin: 40px;
  font-weight: bold;
}
.btn {
  background-color: rgb(53, 1, 53)  !important;
  color: white;
}
.btn:hover {
  background-color: rgb(26, 1, 26) !important;
}
/* Modal Header */
.modal-header {
  padding: 2px 16px;
  background-color: #444644;
  color: white;
}

/* Modal Body */
.modal-body {
  padding: 2px 16px;
  text-align: center;
  }

/* Modal Footer */
.modal-footer {
  padding: 2px 16px;
  background-color: #444644;
  color: white;
}

/* Modal Content */
.modal-content {
  position: relative;
  background-color: #fefefe;
  margin: auto;
  padding: 0;
  border: 1px solid #888;
  width: 80%;
  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
  animation-name: animatetop;
  animation-duration: 0.4s
}

/* Add Animation */
@keyframes animatetop {
  from {top: -300px; opacity: 0}
  to {top: 0; opacity: 1}
}
</style>
</head>
<body>

  <div class="container">
<h2 class="text-center">Survey Questions</h2>

<form>
    <div class="form-group">
        <h3>About You</h3>
      <label for="Name"><b>Name (Required)</b></label>
      <input type="email" class="form-control" id="Name" placeholder="" required/>
    </div>

    <div class="form-group">
        
          <label for="Photo"><b>Link to a Photo Image of you (Required)</b></label>
          <input type="picture" class="form-control" id="Photo" placeholder="">
        </div>
</form>

<h3>Question 1</h3>
<h5>Your mind is always buzzing with unexplored ideas and plans.</h5>
<div class="col-auto my-1" style="width:200px">

        <select class="custom-select mr-sm-2" id="ques1">
          <option selected>Select an Option</option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>

<h3>Question 2</h3>
<h5>Generally speaking, you rely more on your experience than your imagination.</h5>
<div class="col-auto my-1" style="width:200px">

        <select class="custom-select mr-sm-2" id="ques2">
          <option selected>Select an Option</option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>

<h3>Question 3</h3>
<h5>You find it easy to stay relaxed and focused even when there is some pressure.</h5>
<div class="col-auto my-1" style="width:200px">

        <select class="custom-select mr-sm-2" id="ques3">
          <option selected>Select an Option</option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>

      <h3>Question 4</h3>
<h5>You rarely do something just out of sheer curiosity.</h5>
<div class="col-auto my-1" style="width:200px">

        <select class="custom-select mr-sm-2" id="ques4">
          <option selected>Select an Option</option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>

      <h3>Question 5</h3>
<h5>People can rarely upset you.</h5>
<div class="col-auto my-1" style="width:200px">

        <select class="custom-select mr-sm-2" id="ques5">
          <option selected>Select an Option</option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>

      <h3>Question 6</h3>
<h5>It is often difficult for you to relate to other people’s feelings.</h5>
<div class="col-auto my-1" style="width:200px">

        <select class="custom-select mr-sm-2" id="ques6">
          <option selected>Select an Option</option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>

      <h3>Question 7</h3>
<h5>In a discussion, truth should be more important than people’s sensitivities.</h5>
<div class="col-auto my-1" style="width:200px">

        <select class="custom-select mr-sm-2" id="ques7">
          <option selected>Select an Option</option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>

      <h3>Question 8</h3>
<h5>You rarely get carried away by fantasies and ideas.</h5>
<div class="col-auto my-1" style="width:200px">

        <select class="custom-select mr-sm-2" id="ques8">
          <option selected>Select an Option</option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>

      <h3>Question 9</h3>
<h5>You think that everyone’s views should be respected regardless of whether they are supported by facts or not.</h5>
<div class="col-auto my-1" style="width:200px">

        <select class="custom-select mr-sm-2" id="ques9">
          <option selected>Select an Option</option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>

      <h3>Question 10</h3>
<h5>You feel more energetic after spending time with a group of people.</h5>
<div class="col-auto my-1" style="width:200px">

        <select class="custom-select mr-sm-2" id="ques10">
          <option selected>Select an Option</option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>

      <!-- The Modal -->
        <div id="myModal" class="modal">

        <!-- Modal content -->
        <div class="modal-content">
            <div class="modal-header">
                <span class="close">&times;</span>
                
              </div>
              <div class="modal-body">
                  
                </div>
                <div class="modal-footer">
                  
                </div> 
        </div>
      
      </div>

      <button type="button" class="btn submit" id="myBtn" data-toggle="modal" data-target="#myModal">Submit</button>

    <footer class="footer">
      <div class="container">
        <!-- <p><a href="/api/friends">API Friends List</a> | <a href="#">Github Repo</a> -->
      </div>
    </footer>

  </div>



</body>
</html>

<script type="text/javascript">
    
  // Code to grab the data the the user entered after the submit button is clicked
    $(".submit").on("click", function(event) {
      event.preventDefault();
  
     
      // Here we grab the form elements (creates an object)
      var newSurvey = {
        "name": $("#Name").val().trim(),
        "photo": $("#Photo").val().trim(),
        "scores":[$("#ques1").val().trim(),
        $("#ques2").val().trim(),
        $("#ques3").val().trim(),
        $("#ques4").val().trim(),
        $("#ques5").val().trim(),
        $("#ques6").val().trim(),
        $("#ques7").val().trim(),
        $("#ques8").val().trim(),
        $("#ques9").val().trim(),
        $("#ques10").val().trim(),
      ]
      
      };
      if($("#Name").val().trim()=== "") {
      alert("Name is required.");
      return
      }
      if($("#Photo").val().trim()=== "") {
      alert("Photo is required.");
      return
      } 
      if($("#ques1").val().trim()=== "Select an Option" || $("#ques2").val().trim()=== "Select an Option" || $("#ques3").val().trim()=== "Select an Option" || $("#ques4").val().trim()=== "Select an Option" || $("#ques5").val().trim()=== "Select an Option" || $("#ques6").val().trim()=== "Select an Option" || $("#ques7").val().trim()=== "Select an Option" || $("#ques8").val().trim()=== "Select an Option" || $("#ques9").val().trim()=== "Select an Option" || $("#ques10").val().trim()=== "Select an Option")   {
      alert("Question is required.");
      return
      } 
     
      console.log(newSurvey);
  
    // Sending the information from the survey to the friends api
      $.post("/api/friends", newSurvey,
        function(data) {
            console.log(data);
            // alert("success");
          showModal();
  
          // Clear the form when submitting
          $("#Name").val("");
          $("#Photo").val("");
          $("#ques1").val("");
          $("#ques2").val("");
        $("#ques3").val("");
        $("#ques4").val("");
        $("#ques5").val("");
        $("#ques6").val("");
        $("#ques7").val("");
        $("#ques8").val("");
        $("#ques9").val("");
        $("#ques10").val("");
        })
        .fail(function() {
        alert( "error" );
        })
        .always(function() {
        // alert( "finished" );
        modal.style.display = "block";
  });
  
  
    }); 
   
    // Function to show to modal pop up
    function showModal() {
      // Getting the data from the api/friends
        $.ajax({ url: "/api/friends", method: "GET" })
      .then(function(data) {
          
        // Here we then log the tableData to console, where it will show up as an object.
        console.log(data);
        console.log("------------------------------------");
        //Creating empty arrays to send data to
        var differencesArray = [];
        var difffandScoresArray = [];
        // Using a for loop to loop through all of the data
                for(var i=0; i<data.length;i++) {
                  //setting a variable equal to all of the scores in the data array
                var scoresarray = data[i].scores;
                    var name = data[i].name;
                    console.log(name);
                   
                    var photo = data[i].photo;
                    
                    console.log(photo);
                    var A = scoresarray;
                    
                    console.log("var a: " + A);
                    // Finding the number to plug into the array to get the current user's position in the array
                    var number = data.length - 1
                    console.log("number:" + number);
                    // Plugging the number into the array to get the current user; set it equal to a variable to compare to other users
                    var B = data[number].scores;
                    console.log("var b: " + B);
                    // Function to get the absolute value of all the numbers in the scores array for variable a minus variable b
                    var C = A.map(function (v, i) { return Math.abs(v - B[i]); });
                    console.log("var c: " + C)
                    // Function to add all of the numbers up from the new array found in variable C
                    var totalDifference = C.reduce(add,0);
                    function add(a, b) {
                        return a + b;
                    //Pushing the total differences in to the empty array
                    } differencesArray.push(totalDifference);
                    
                   
                   console.log("total difference: " + totalDifference);
                     
                    console.log("------------------------------------");   
                
                  
                    
                    
                    
                     
                    //Creating an object to access the name and photo of the best friend
                     var info = {
                      "name": data[i].name,
                      "photo": data[i].photo,
                      "totaldiff": totalDifference
                    }// sending the object for each person in the data array to the empty array
                    difffandScoresArray.push(info);
                      
                };  
                    console.log(info);
                    console.log(differencesArray);
                    console.log(difffandScoresArray);
                    //Finding the smallest number in the differences array and excluding the number zero;
                    // Zero is excluded because 0 differences is the current user
                    var bestfriend = Math.min.apply(Math, differencesArray.filter(Number));
                    console.log(bestfriend);
                    // Creating a for loop to loop through the new array 
                    for(var i =0; i<difffandScoresArray.length; i++) {

                      //if the totaldifference is equal to the number found to be the best friend's difference number(least amount of difference)
                      if(difffandScoresArray[i].totaldiff === bestfriend) {
                        console.log("Name: " + difffandScoresArray[i].name);
                        console.log("Photo: " + difffandScoresArray[i].photo);

                   //Call reset modal function to empty the modal
                         resetModal(); 
                        // Get the modal
                  var modal = document.getElementById('myModal');
                 

                  //Get the button that opens the modal
                  var btn = document.getElementById("myBtn");

                  //Get the <span> element that closes the modal
                  var span = document.getElementsByClassName("close")[0];

                  //When the user clicks on the button, open the modal
                  btn.onclick = function() {
                    
                      modal.style.display = "block";
                      
                  }

                  //When the user clicks on <span> (x), close the modal
                  span.onclick = function() {
                   
                      modal.style.display = "none";
                     
                  }

                  //When the user clicks anywhere outside of the modal, close it
                  window.onclick = function(event) {
                      if (event.target == modal) {
                          modal.style.display = "none";
                         
                      }
                  }         
                          // Create a div    
                            var Div = $("<div>");
                            //Create an image
                        var image =  $("<img>");
                        //add an attribute and class to the image
                        image.attr("src", difffandScoresArray[i].photo);
                        image.addClass("image");
                        Div.prepend(image);
                        Div.addClass("imagediv");
                        //Add the info for the current best friend into the modal
                        $(".modal-body").append(
                        $("<h1>").text("Best Match").addClass("info"),
                        $("<hr>").addClass("info"),
                        $("<h2>").addClass("info").text("Name: " + difffandScoresArray[i].name),
                          Div,
                       
                    )      
              }
              
                    }
                   
                    
                    
                    
                   })
                  //  $('#myModal').modal('show');        

}



// Run the show modal function
// $(document).ready(function(){
// showModal();           
// });

// Reset modal function
function resetModal() {
  $(".info").empty().remove(),      
  $(".imagediv").empty().remove()
}
              



      


    
  </script>