<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Friend Finder</title>

 
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<style>
     /* The Modal (background) */
.modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1; /* Sit on top */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgb(0,0,0); /* Fallback color */
    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content/Box */
.modal-content {
    background-color: #fefefe;
    margin: 15% auto; /* 15% from the top and centered */
    padding: 20px;
    border: 1px solid #888;
    width: 80%; /* Could be more or less, depending on screen size */
}

/* The Close Button */
.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
} 
</style>
</head>
<body>

  <div class="container">
<h2>Survey Questions</h2>

<form>
    <div class="form-group">
        <h3>About You</h3>
      <label for="Name">Name (Required)</label>
      <input type="email" class="form-control" id="Name" placeholder="">
    </div>

    <div class="form-group">
        
          <label for="Photo">Link to Photo Image (Required)</label>
          <input type="email" class="form-control" id="Photo" placeholder="">
        </div>
</form>

<h3>Question 1</h3>
<h5>Your mind is always buzzing with unexplored ideas and plans.</h5>
<div class="col-auto my-1" style="width:200px">

        <select class="custom-select mr-sm-2" id="ques1">
          <option selected>Select an Option</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </div>

<h3>Question 2</h3>
<h5>Generally speaking, you rely more on your experience than your imagination.</h5>
<div class="col-auto my-1" style="width:200px">

        <select class="custom-select mr-sm-2" id="ques2">
          <option selected>Select an Option</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </div>

<h3>Question 3</h3>
<h5>You find it easy to stay relaxed and focused even when there is some pressure.</h5>
<div class="col-auto my-1" style="width:200px">

        <select class="custom-select mr-sm-2" id="ques3">
          <option selected>Select an Option</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </div>

      <h3>Question 4</h3>
<h5>You rarely do something just out of sheer curiosity.</h5>
<div class="col-auto my-1" style="width:200px">

        <select class="custom-select mr-sm-2" id="ques4">
          <option selected>Select an Option</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </div>

      <h3>Question 5</h3>
<h5>People can rarely upset you.</h5>
<div class="col-auto my-1" style="width:200px">

        <select class="custom-select mr-sm-2" id="ques5">
          <option selected>Select an Option</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </div>

      <h3>Question 6</h3>
<h5>It is often difficult for you to relate to other people’s feelings.</h5>
<div class="col-auto my-1" style="width:200px">

        <select class="custom-select mr-sm-2" id="ques6">
          <option selected>Select an Option</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </div>

      <h3>Question 7</h3>
<h5>In a discussion, truth should be more important than people’s sensitivities.</h5>
<div class="col-auto my-1" style="width:200px">

        <select class="custom-select mr-sm-2" id="ques7">
          <option selected>Select an Option</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </div>

      <h3>Question 8</h3>
<h5>You rarely get carried away by fantasies and ideas.</h5>
<div class="col-auto my-1" style="width:200px">

        <select class="custom-select mr-sm-2" id="ques8">
          <option selected>Select an Option</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </div>

      <h3>Question 9</h3>
<h5>You think that everyone’s views should be respected regardless of whether they are supported by facts or not.</h5>
<div class="col-auto my-1" style="width:200px">

        <select class="custom-select mr-sm-2" id="ques9">
          <option selected>Select an Option</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </div>

      <h3>Question 10</h3>
<h5>You feel more energetic after spending time with a group of people.</h5>
<div class="col-auto my-1" style="width:200px">

        <select class="custom-select mr-sm-2" id="ques10">
          <option selected>Select an Option</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </div>

      <!-- The Modal -->
        <div id="myModal" class="modal">

        <!-- Modal content -->
        <div class="modal-content">
          <span class="close">&times;</span>
          <p>Some text in the Modal..</p>
        </div>
      
      </div>

      <button type="button" class="btn btn-primary submit" id="myBtn">Submit</button>

    <footer class="footer">
      <div class="container">
        <p><a href="/api/friends">API Friends List</a> | <a href="#">Github Repo</a>
      </div>
    </footer>

  </div>



</body>
</html>

<script type="text/javascript">
    
  // Code to grab the data the the user entered after the submit button is clicked
    $(".submit").on("click", function(event) {
      event.preventDefault();
  
      // Here we grab the form elements (creates an object)
      var newSurvey = {
        "name": $("#Name").val().trim(),
        "photo": $("#Photo").val().trim(),
        "scores":[$("#ques1").val().trim(),
        $("#ques2").val().trim(),
        $("#ques3").val().trim(),
        $("#ques4").val().trim(),
        $("#ques5").val().trim(),
        $("#ques6").val().trim(),
        $("#ques7").val().trim(),
        $("#ques8").val().trim(),
        $("#ques9").val().trim(),
        $("#ques10").val().trim(),
      ]
      };
  
      console.log(newSurvey);
  
    // Sending the information from the survey to the friends api
      $.post("/api/friends", newSurvey,
        function(data) {
            console.log(data);
            alert("success");
          showModal();
  
          // Clear the form when submitting
          $("#Name").val("");
          $("#Photo").val("");
          $("#ques1").val("");
          $("#ques2").val("");
        $("#ques3").val("");
        $("#ques4").val("");
        $("#ques5").val("");
        $("#ques6").val("");
        $("#ques7").val("");
        $("#ques8").val("");
        $("#ques9").val("");
        $("#ques10").val("");
        })
        .fail(function() {
        alert( "error" );
        })
        .always(function() {
        alert( "finished" );
  });
  
    }); 
                
    function showModal() {
        $.ajax({ url: "/api/friends", method: "GET" })
      .then(function(data) {
          
        // Here we then log the tableData to console, where it will show up as an object.
        console.log(data);
        console.log("------------------------------------");
        var differencesArray = [];
        var difffandScoresArray = [];
                for(var i=0; i<data.length;i++) {
                var scoresarray = data[i].scores;
                // console.log(friendsData[i].scores);
                    
               
                    var name = data[i].name;
                    console.log(name);
                   
                    var photo = data[i].photo;
                    
                    console.log(photo);
                    var A = scoresarray;
                    
                    console.log("var a: " + A)
                    var number = data.length - 1
                    console.log("number:" + number)
                    var B = data[number].scores;
                    console.log("var b: " + B)
                    var C = A.map(function (v, i) { return Math.abs(v - B[i]); });
                    console.log("var c: " + C)
                    var totalDifference = C.reduce(add,0);
                    function add(a, b) {
                        return a + b;
                    } differencesArray.push(totalDifference);
                    
                   
                   console.log("total difference: " + totalDifference);
                     
                    console.log("------------------------------------");   
                
                  
                    
                    
                    
                     
                    
                     var info = {
                      "name": data[i].name,
                      "photo": data[i].photo,
                      "totaldiff": totalDifference
                    }
                    difffandScoresArray.push(info);
                      
                };  
                    console.log(info);
                    console.log(differencesArray);
                    console.log(difffandScoresArray);
                    var bestfriend = Math.min.apply(Math, differencesArray.filter(Number));
                    console.log(bestfriend);
                    for(var i =0; i<difffandScoresArray.length; i++) {
                      if(difffandScoresArray[i].totaldiff === bestfriend) {
                        console.log("Name: " + difffandScoresArray[i].name);
                        console.log("Photo: " + difffandScoresArray[i].photo)
                      }
                      
                    }
                   
                    
                    
                    
                   })
                   

}

                
                //    if(totalDifference < 20) {

// Get the modal
// var modal = document.getElementById('myModal');















// Get the button that opens the modal
// var btn = document.getElementById("myBtn");

// Get the <span> element that closes the modal
// var span = document.getElementsByClassName("close")[0];

// When the user clicks on the button, open the modal
// btn.onclick = function() {
//     modal.style.display = "block";
// }

// When the user clicks on <span> (x), close the modal
// span.onclick = function() {
//     modal.style.display = "none";
// }

// When the user clicks anywhere outside of the modal, close it
// window.onclick = function(event) {
//     if (event.target == modal) {
//         modal.style.display = "none";
//     }
// } 
// modal.append(
//         $("<h1>").text("Best Match"),
//         $("<hr>"),
//         $("<h2>").text("Name: " + data[1].name),
//         $("<h2>").text(data[1].photo),
//     )               



      


    
  </script>